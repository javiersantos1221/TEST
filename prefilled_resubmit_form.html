<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Form Submission Test</title>
   <style>
       body {
           font-family: Arial, sans-serif;
           max-width: 600px;
           margin: 50px auto;
           padding: 20px;
           background-color: #f5f5f5;
       }
       .container {
           background: white;
           padding: 30px;
           border-radius: 10px;
           box-shadow: 0 2px 10px rgba(0,0,0,0.1);
       }
       h1 {
           color: #333;
           text-align: center;
           margin-bottom: 30px;
       }
       .form-group {
           margin-bottom: 20px;
       }
       label {
           display: block;
           font-weight: bold;
           margin-bottom: 5px;
           color: #555;
       }
       input, textarea {
           width: 100%;
           padding: 12px;
           border: 2px solid #ddd;
           border-radius: 5px;
           font-size: 16px;
           box-sizing: border-box;
       }
       input:focus, textarea:focus {
           border-color: #007cba;
           outline: none;
       }
       textarea {
           height: 100px;
           resize: vertical;
       }
       .submit-btn {
           background-color: #007cba;
           color: white;
           padding: 15px 30px;
           border: none;
           border-radius: 5px;
           font-size: 16px;
           font-weight: bold;
           cursor: pointer;
           width: 100%;
           transition: background-color 0.3s;
       }
       .submit-btn:hover {
           background-color: #005a87;
       }
       .resubmit-notice {
           background-color: #fff3cd;
           border: 1px solid #ffeaa7;
           border-radius: 5px;
           padding: 15px;
           margin-bottom: 30px;
           color: #856404;
       }
       .instructions {
           background-color: #e7f3ff;
           border: 1px solid #b3d9ff;
           border-radius: 5px;
           padding: 15px;
           margin-bottom: 30px;
       }
       .instructions h3 {
           margin-top: 0;
           color: #0066cc;
       }
       .step {
           margin: 10px 0;
           padding-left: 20px;
       }
       .auto-id {
           background-color: #f8f9fa;
           color: #666;
           font-family: monospace;
           font-size: 14px;
       }
       .webhook-info {
           background-color: #fff3cd;
           border: 1px solid #ffeaa7;
           border-radius: 5px;
           padding: 15px;
           margin-top: 20px;
           font-size: 14px;
       }

       /* Popup Modal Styles */
       .modal-overlay {
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background-color: rgba(0, 0, 0, 0.5);
           display: flex;
           justify-content: center;
           align-items: center;
           z-index: 1000;
       }

       .modal-content {
           background-color: #2d3748;
           color: white;
           padding: 24px;
           border-radius: 8px;
           max-width: 500px;
           width: 90%;
           max-height: 80vh;
           overflow-y: auto;
           position: relative;
       }

       .modal-header {
           font-size: 20px;
           font-weight: 600;
           margin-bottom: 16px;
       }

       .modal-status {
           display: flex;
           align-items: center;
           gap: 8px;
           margin-bottom: 16px;
       }

       .success-icon {
           color: #48bb78;
           font-size: 18px;
       }

       .error-icon {
           color: #f56565;
           font-size: 18px;
       }

       .modal-body {
           color: #cbd5e0;
           line-height: 1.6;
           margin-bottom: 24px;
       }

       .modal-checklist {
           margin-top: 16px;
       }

       .checklist-header {
           display: flex;
           align-items: center;
           gap: 8px;
           margin-bottom: 8px;
       }

       .checklist-bullet {
           width: 8px;
           height: 8px;
           background-color: #3182ce;
           border-radius: 50%;
           display: inline-block;
           margin-right: 8px;
       }

       .checklist-item {
           color: #cbd5e0;
           margin-left: 16px;
           margin-bottom: 4px;
       }

       .modal-footer {
           display: flex;
           justify-content: flex-end;
       }

       .modal-button {
           background-color: #3182ce;
           color: white;
           padding: 10px 24px;
           border: none;
           border-radius: 4px;
           font-weight: 600;
           cursor: pointer;
           transition: background-color 0.2s;
       }

       .modal-button:hover {
           background-color: #2c5282;
       }

       .modal-close {
           position: absolute;
           top: 8px;
           right: 12px;
           background: none;
           border: none;
           color: #a0aec0;
           font-size: 20px;
           cursor: pointer;
           padding: 4px;
       }

       .modal-close:hover {
           color: white;
       }

       .hidden {
           display: none;
       }
   </style>
</head>
<body>
   <div class="container">
       <h1 id="pageTitle">üöÄ N8N Form Approval Workflow Test</h1>
       
       <div id="resubmitNotice" class="resubmit-notice" style="display: none;">
           <h3>üìù Resubmitting Your Form</h3>
           <p>Your previous submission was not approved. Please make any necessary corrections and resubmit.</p>
           <p><strong>Original Submission ID:</strong> <span id="originalId"></span></p>
       </div>
       
       <div class="instructions">
           <h3>üìã Testing Instructions:</h3>
           <div class="step">1. <strong>Activate the webhook:</strong> In n8n, click "Execute workflow" or "Listen for test event" on the form submission webhook</div>
           <div class="step">2. <strong>Fill out the form below</strong> and submit it</div>
           <div class="step">3. <strong>Check your email</strong> (jj.santos5734@gmail.com) for the approval email</div>
           <div class="step">4. <strong>Check your Google Sheet</strong> to see the new row with "pending" status</div>
           <div class="step">5. <strong>Before clicking approve/reject:</strong> Go to n8n and click "Listen for test event" on the "Webhook Admin Decision" node</div>
           <div class="step">6. <strong>Click approve or reject</strong> in the email</div>
           <div class="step">7. <strong>Check the submitted email</strong> for confirmation/rejection and verify Google Sheet status update</div>
       </div>

       <form id="submissionForm" method="POST">
           <div class="form-group">
               <label for="id">Submission ID (Auto-generated)</label>
               <input type="text" id="id" name="id" class="auto-id" readonly placeholder="Auto-generated ID">
           </div>

           <div class="form-group">
               <label for="name">Full Name *</label>
               <input type="text" id="name" name="name" required placeholder="Enter your full name">
           </div>

           <div class="form-group">
               <label for="email">Email Address *</label>
               <input type="email" id="email" name="email" required placeholder="your.email@example.com">
           </div>

           <div class="form-group">
               <label for="company">Company (Optional)</label>
               <input type="text" id="company" name="company" placeholder="Your company name">
           </div>

           <div class="form-group">
               <label for="message">Message (Optional)</label>
               <textarea id="message" name="message" placeholder="Additional information or comments"></textarea>
           </div>

           <button type="submit" class="submit-btn" id="submitBtn">üì® Submit Form for Approval</button>
       </form>

       <div class="webhook-info">
           <strong>üîó Webhook Endpoints:</strong><br>
           <strong>Form Submission:</strong> https://jsantos5734.app.n8n.cloud/webhook-test/submit-form<br>
           <strong>Admin Decision:</strong> https://jsantos5734.app.n8n.cloud/webhook-test/approve
       </div>
   </div>

   <!-- Success Modal -->
   <div id="successModal" class="modal-overlay hidden">
       <div class="modal-content">
           <button class="modal-close" onclick="closeModal('successModal')">&times;</button>
           <div class="modal-header">This page says</div>
           <div class="modal-status">
               <span class="success-icon">‚úÖ</span>
               <span style="color: #48bb78; font-weight: 600;">Success!</span>
           </div>
           <div class="modal-body">
               <p>Thank you! Your form has been submitted successfully. You will receive an email confirmation once it has been reviewed and approved by our admin team (usually within 24 hours).</p>
               <div class="modal-checklist">
                   <div class="checklist-header">
                       <div class="checklist-bullet"></div>
                       <span style="font-weight: 600;">Now check:</span>
                   </div>
                   <div class="checklist-item">‚Ä¢ Your email for the approval request</div>
                   <div class="checklist-item">‚Ä¢ Your Google Sheet for the new row</div>
                   <div class="checklist-item">‚Ä¢ Make sure to activate the admin webhook before clicking approve/reject!</div>
               </div>
           </div>
           <div class="modal-footer">
               <button class="modal-button" onclick="closeModal('successModal')">OK</button>
           </div>
       </div>
   </div>

   <!-- Error Modal -->
   <div id="errorModal" class="modal-overlay hidden">
       <div class="modal-content">
           <button class="modal-close" onclick="closeModal('errorModal')">&times;</button>
           <div class="modal-header">This page says</div>
           <div class="modal-status">
               <span class="error-icon">‚ùå</span>
               <span style="color: #f56565; font-weight: 600;">Error</span>
           </div>
           <div class="modal-body">
               <p id="errorMessage">An error occurred while submitting the form.</p>
           </div>
           <div class="modal-footer">
               <button class="modal-button" onclick="closeModal('errorModal')">OK</button>
           </div>
       </div>
   </div>

   <script>
       // Modal functions
       function showModal(modalId) {
           document.getElementById(modalId).classList.remove('hidden');
       }

       function closeModal(modalId) {
           document.getElementById(modalId).classList.add('hidden');
       }

       // Close modal when clicking outside
       document.addEventListener('click', function(e) {
           if (e.target.classList.contains('modal-overlay')) {
               closeModal(e.target.id);
           }
       });

       // Generate unique ID when page loads
       function generateId() {
           return 'form-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
       }
       
       // Get URL parameters
       function getUrlParameter(name) {
           name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
           var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
           var results = regex.exec(location.search);
          return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' ')).replace(/%20/g, ' ');
       }
       
       // Check if this is a resubmission
       const isResubmit = getUrlParameter('resubmit') === 'true';
       const originalId = getUrlParameter('originalId');
       const prefilledEmail = getUrlParameter('email');
       const prefilledName = getUrlParameter('name');
       const prefilledCompany = getUrlParameter('company');
       const prefilledMessage = getUrlParameter('message');
       
       if (isResubmit) {
           // Show resubmit notice
           document.getElementById('resubmitNotice').style.display = 'block';
           document.getElementById('originalId').textContent = originalId || 'Unknown';
           document.getElementById('pageTitle').textContent = 'üîÑ Resubmit Your Form';
           document.getElementById('submitBtn').textContent = 'üîÑ Resubmit Form for Approval';
           
           // Pre-fill form with existing data
           if (prefilledEmail) document.getElementById('email').value = prefilledEmail;
           if (prefilledName) document.getElementById('name').value = prefilledName;
           if (prefilledCompany) document.getElementById('company').value = prefilledCompany;
           if (prefilledMessage) document.getElementById('message').value = prefilledMessage;
       }
       
       // Generate or set ID
       if (isResubmit && originalId) {
           document.getElementById('id').value = originalId;
       } else {
           document.getElementById('id').value = generateId();
       }

       document.getElementById('submissionForm').addEventListener('submit', async function(e) {
           e.preventDefault();
           
           const formData = new FormData(this);
           const data = Object.fromEntries(formData);
           
           // Structure data to match your n8n workflow expectations
           const payload = {
               body: {
                   id: data.id,
                   name: data.name,
                   email: data.email,
                   company: data.company || '',
                   message: data.message || '',
                   isResubmission: isResubmit,
                   originalSubmissionId: originalId || null
               }
           };
           
           const submitBtn = document.querySelector('.submit-btn');
           const originalText = submitBtn.textContent;
           submitBtn.textContent = '‚è≥ Submitting...';
           submitBtn.disabled = true;
           
           try {
               const response = await fetch('https://jsantos5734.app.n8n.cloud/webhook-test/submit-form', {
                   method: 'POST',
                   headers: {
                       'Content-Type': 'application/json',
                   },
                   body: JSON.stringify(payload)
               });
               
               const result = await response.text();
               
               if (response.ok) {
                   // Show success modal instead of alert
                   showModal('successModal');
                   
                   // Generate new ID for next test
                   document.getElementById('id').value = generateId();
                   // Clear other fields except pre-filled ones
                   if (!isResubmit) {
                       document.getElementById('name').value = '';
                       document.getElementById('email').value = '';
                   }
                   document.getElementById('company').value = '';
                   document.getElementById('message').value = '';
               } else {
                   // Show error modal with specific message
                   document.getElementById('errorMessage').innerHTML = 
                       `<strong>Error:</strong> ${result}<br><br>` +
                       `<strong>Please check:</strong><br>` +
                       `‚Ä¢ Your n8n workflow is active<br>` +
                       `‚Ä¢ The webhook URL is correct<br>` +
                       `‚Ä¢ Make sure your webhook is listening!`;
                   showModal('errorModal');
               }
           } catch (error) {
               // Show error modal for network errors
               document.getElementById('errorMessage').innerHTML = 
                   `<strong>Network Error:</strong> ${error.message}<br><br>` +
                   `<strong>Please check:</strong><br>` +
                   `‚Ä¢ Your n8n workflow is active<br>` +
                   `‚Ä¢ The webhook URL is correct<br>` +
                   `‚Ä¢ Your internet connection is working`;
               showModal('errorModal');
           } finally {
               submitBtn.textContent = originalText;
               submitBtn.disabled = false;
           }
       });
   </script>
</body>
</html>
